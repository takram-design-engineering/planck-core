!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs"),require("request"),require("text-encoding")):"function"==typeof define&&define.amd?define(["exports","fs","request","text-encoding"],t):t(e.Planck=e.Planck||{},e.fs,e.request,e.encoding)}(this,function(e,t,r,n){"use strict";function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=Symbol(e);return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return void 0===e[t]&&(e[t]=r({})),e[t]}}function i(e){this.message=e}function a(){switch(_.type){case"browser":var e=document.currentScript||document._currentScript;return e?e.src:null;case"worker":return self.location.href;case"node":return __filename}throw new Error}function u(e,t){return t={exports:{}},e(t,t.exports),t.exports}function s(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function c(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&s(e.slice(0,0))}function f(e){return re.lastIndex=0,re.test(e)?'"'+e.replace(re,function(e){var t=ne[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function l(e,t){var r,n,o,i,a,u=$,s=t[e];switch(s&&"object"===(void 0===s?"undefined":j(s))&&"function"==typeof s.toJSON&&(s=s.toJSON(e)),"function"==typeof te&&(s=te.call(t,e,s)),void 0===s?"undefined":j(s)){case"string":return f(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if($+=ee,a=[],"[object Array]"===Object.prototype.toString.apply(s)){for(i=s.length,r=0;r<i;r+=1)a[r]=l(r,s)||"null";return o=0===a.length?"[]":$?"[\n"+$+a.join(",\n"+$)+"\n"+u+"]":"["+a.join(",")+"]",$=u,o}if(te&&"object"===(void 0===te?"undefined":j(te)))for(i=te.length,r=0;r<i;r+=1)"string"==typeof(n=te[r])&&(o=l(n,s))&&a.push(f(n)+($?": ":":")+o);else for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(o=l(n,s))&&a.push(f(n)+($?": ":":")+o);return o=0===a.length?"{}":$?"{\n"+$+a.join(",\n"+$)+"\n"+u+"}":"{"+a.join(",")+"}",$=u,o}}function p(e){this.message=e}function h(e){return decodeURIComponent(e.replace(/\+/g," "))}function y(e){var t,r={},n=void 0===(e=e||U.location||{})?"undefined":j(e);if("blob:"===e.protocol)r=new g(unescape(e.pathname),{});else if("string"===n){r=new g(e,{});for(t in ge)delete r[t]}else if("object"===n){for(t in e)t in ge||(r[t]=e[t]);void 0===r.slashes&&(r.slashes=ve.test(e.href))}return r}function v(e){var t=ye.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function d(e,t){for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,o=r[n-1],i=!1,a=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),a++):a&&(0===n&&(i=!0),r.splice(n,1),a--);return i&&r.unshift(""),"."!==o&&".."!==o||r.push(""),r.join("/")}function g(e,t,r){if(!(this instanceof g))return new g(e,t,r);var n,o,i,a,u,s,c=de.slice(),f=void 0===t?"undefined":j(t),l=this,p=0;for("object"!==f&&"string"!==f&&(r=t,t=null),r&&"function"!=typeof r&&(r=he.parse),t=y(t),n=!(o=v(e||"")).protocol&&!o.slashes,l.slashes=o.slashes||n&&t.slashes,l.protocol=o.protocol||t.protocol||"",e=o.rest,o.slashes||(c[2]=[/(.*)/,"pathname"]);p<c.length;p++)i=(a=c[p])[0],s=a[1],i!==i?l[s]=e:"string"==typeof i?~(u=e.indexOf(i))&&("number"==typeof a[2]?(l[s]=e.slice(0,u),e=e.slice(u+a[2])):(l[s]=e.slice(u),e=e.slice(0,u))):(u=i.exec(e))&&(l[s]=u[1],e=e.slice(0,u.index)),l[s]=l[s]||(n&&a[3]?t[s]||"":""),a[4]&&(l[s]=l[s].toLowerCase());r&&(l.query=r(l.query)),n&&t.slashes&&"/"!==l.pathname.charAt(0)&&(""!==l.pathname||""!==t.pathname)&&(l.pathname=d(l.pathname,t.pathname)),le(l.port,l.protocol)||(l.host=l.hostname,l.port=""),l.username=l.password="",l.auth&&(a=l.auth.split(":"),l.username=a[0]||"",l.password=a[1]||""),l.origin=l.protocol&&l.host&&"file:"!==l.protocol?l.protocol+"//"+l.host:"null",l.href=l.toString()}function w(e,t){return new Promise(function(r,n){var o=new be(e,!0);t.query&&o.set("query",Object.assign({},o.query,t.query));var i=new XMLHttpRequest;i.open("get",o.toString(),!0),t.headers&&Object.entries(t.headers).forEach(function(e){i.setRequestHeader.apply(i,k(e))}),i.responseType=t.type,i.addEventListener("loadend",function(e){i.status<200||i.status>=300?n(i.status):null!==i.response||"json"!==t.type?r(i.response):n(new Error("Could not parse JSON"))},!1),i.send()})}function b(e,n){return n.local?new Promise(function(r,o){t.readFile(e,n.encoding,function(e,t){e?o(e):r(t)})}):new Promise(function(t,o){r({url:e,headers:n.headers||{},qs:n.query||{},encoding:n.encoding},function(e,r){e?o(e):((r.statusCode<200||r.statusCode>=300)&&o(r.statusCode),t(r.body))})})}function m(e,t){if("node"===_.type){var r=b(e,t);return"json"===t.type?r.then(function(e){if("string"!=typeof e)throw new Error("Response is unexpectedly not a string");return JSON.parse(e)}):"arraybuffer"===t.type?r.then(function(e){if(!(e instanceof Buffer))throw new Error("Response is unexpectedly not a buffer");for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}):r}return w(e,t)}function A(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0],o=t[1];if("string"!=typeof n&&(n=(o=n).url),"string"!=typeof n)throw new Error("The first argument or options.url must be a string");return o=Object.assign({},{type:"text",local:!1,encoding:"utf-8"},o),[n,o]}r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},x=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),O=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},E=o("AggregateFunction"),q=function(){function e(t){if(S(this,e),t!==E)throw new Error;for(var r=E(this),n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];r.targets=o}return x(e,[{key:"apply",value:function(e,t,r){return E(this).targets.map(function(e){return Reflect.apply(e,t,r)})}},{key:"getPrototypeOf",value:function(e){return this.constructor.prototype}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new(Function.prototype.bind.apply(this,[null].concat([E],t)));return new Proxy(function(){},n)}}]),e}(),T=o("Aggregate"),C=function(){function e(t){if(S(this,e),t!==T)throw new Error;for(var r=T(this),n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];r.targets=o}return x(e,[{key:"set",value:function(e,t,r,n){return T(this).targets.forEach(function(e){Reflect.set(e,t,r)}),Reflect.set(e,t,r,n)}},{key:"get",value:function(e,t,r){var n=T(this);return n.targets.every(function(e){return"function"==typeof Reflect.get(e,t)})?q.new.apply(q,k(n.targets.map(function(e){return Reflect.get(e,t).bind(e)}))):Reflect.get(n.targets[0],t,r)}},{key:"getPrototypeOf",value:function(e){return this.constructor.prototype}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new(Function.prototype.bind.apply(this,[null].concat([T],t)));return new Proxy({},n)}}]),e}();Object.setPrototypeOf(i,Error),(i.prototype=Object.create(Error.prototype)).name="AssertionError",i.prototype.message="",i.prototype.constructor=i;var P,B,N,R,_={get type(){try{if(new Function("return this === window")())return"browser"}catch(e){}try{if(new Function("return this === self")())return"worker"}catch(e){}try{if(new Function("return this === global")())return"node"}catch(e){}throw new Error},get self(){switch(this.type){case"browser":return window;case"worker":return self;case"node":return global}throw new Error}},F=a(),M={get self(){return F},get current(){return a()}},U="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=u(function(e){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var o=e[n]<<16|e[n+1]<<8|e[n+2],i=0;i<4;i++)8*n+6*i<=8*e.length?r.push(t.charAt(o>>>6*(3-i)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,o=0;n<e.length;o=++n%4)0!=o&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(n))>>>6-2*o);return r}};e.exports=r}()}),J={utf8:{stringToBytes:function(e){return J.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(J.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},L=J,D=function(e){return null!=e&&(s(e)||c(e)||!!e._isBuffer)},z=u(function(e){!function(){var t=I,r=L.utf8,n=D,o=L.bin,i=function e(i,a){i.constructor==String?i=a&&"binary"===a.encoding?o.stringToBytes(i):r.stringToBytes(i):n(i)?i=Array.prototype.slice.call(i,0):Array.isArray(i)||(i=i.toString());for(var u=t.bytesToWords(i),s=8*i.length,c=1732584193,f=-271733879,l=-1732584194,p=271733878,h=0;h<u.length;h++)u[h]=16711935&(u[h]<<8|u[h]>>>24)|4278255360&(u[h]<<24|u[h]>>>8);u[s>>>5]|=128<<s%32,u[14+(s+64>>>9<<4)]=s;for(var y=e._ff,v=e._gg,d=e._hh,g=e._ii,h=0;h<u.length;h+=16){var w=c,b=f,m=l,A=p;f=g(f=g(f=g(f=g(f=d(f=d(f=d(f=d(f=v(f=v(f=v(f=v(f=y(f=y(f=y(f=y(f,l=y(l,p=y(p,c=y(c,f,l,p,u[h+0],7,-680876936),f,l,u[h+1],12,-389564586),c,f,u[h+2],17,606105819),p,c,u[h+3],22,-1044525330),l=y(l,p=y(p,c=y(c,f,l,p,u[h+4],7,-176418897),f,l,u[h+5],12,1200080426),c,f,u[h+6],17,-1473231341),p,c,u[h+7],22,-45705983),l=y(l,p=y(p,c=y(c,f,l,p,u[h+8],7,1770035416),f,l,u[h+9],12,-1958414417),c,f,u[h+10],17,-42063),p,c,u[h+11],22,-1990404162),l=y(l,p=y(p,c=y(c,f,l,p,u[h+12],7,1804603682),f,l,u[h+13],12,-40341101),c,f,u[h+14],17,-1502002290),p,c,u[h+15],22,1236535329),l=v(l,p=v(p,c=v(c,f,l,p,u[h+1],5,-165796510),f,l,u[h+6],9,-1069501632),c,f,u[h+11],14,643717713),p,c,u[h+0],20,-373897302),l=v(l,p=v(p,c=v(c,f,l,p,u[h+5],5,-701558691),f,l,u[h+10],9,38016083),c,f,u[h+15],14,-660478335),p,c,u[h+4],20,-405537848),l=v(l,p=v(p,c=v(c,f,l,p,u[h+9],5,568446438),f,l,u[h+14],9,-1019803690),c,f,u[h+3],14,-187363961),p,c,u[h+8],20,1163531501),l=v(l,p=v(p,c=v(c,f,l,p,u[h+13],5,-1444681467),f,l,u[h+2],9,-51403784),c,f,u[h+7],14,1735328473),p,c,u[h+12],20,-1926607734),l=d(l,p=d(p,c=d(c,f,l,p,u[h+5],4,-378558),f,l,u[h+8],11,-2022574463),c,f,u[h+11],16,1839030562),p,c,u[h+14],23,-35309556),l=d(l,p=d(p,c=d(c,f,l,p,u[h+1],4,-1530992060),f,l,u[h+4],11,1272893353),c,f,u[h+7],16,-155497632),p,c,u[h+10],23,-1094730640),l=d(l,p=d(p,c=d(c,f,l,p,u[h+13],4,681279174),f,l,u[h+0],11,-358537222),c,f,u[h+3],16,-722521979),p,c,u[h+6],23,76029189),l=d(l,p=d(p,c=d(c,f,l,p,u[h+9],4,-640364487),f,l,u[h+12],11,-421815835),c,f,u[h+15],16,530742520),p,c,u[h+2],23,-995338651),l=g(l,p=g(p,c=g(c,f,l,p,u[h+0],6,-198630844),f,l,u[h+7],10,1126891415),c,f,u[h+14],15,-1416354905),p,c,u[h+5],21,-57434055),l=g(l,p=g(p,c=g(c,f,l,p,u[h+12],6,1700485571),f,l,u[h+3],10,-1894986606),c,f,u[h+10],15,-1051523),p,c,u[h+1],21,-2054922799),l=g(l,p=g(p,c=g(c,f,l,p,u[h+8],6,1873313359),f,l,u[h+15],10,-30611744),c,f,u[h+6],15,-1560198380),p,c,u[h+13],21,1309151649),l=g(l,p=g(p,c=g(c,f,l,p,u[h+4],6,-145523070),f,l,u[h+11],10,-1120210379),c,f,u[h+2],15,718787259),p,c,u[h+9],21,-343485551),c=c+w>>>0,f=f+b>>>0,l=l+m>>>0,p=p+A>>>0}return t.endian([c,f,l,p])};i._ff=function(e,t,r,n,o,i,a){var u=e+(t&r|~t&n)+(o>>>0)+a;return(u<<i|u>>>32-i)+t},i._gg=function(e,t,r,n,o,i,a){var u=e+(t&n|r&~n)+(o>>>0)+a;return(u<<i|u>>>32-i)+t},i._hh=function(e,t,r,n,o,i,a){var u=e+(t^r^n)+(o>>>0)+a;return(u<<i|u>>>32-i)+t},i._ii=function(e,t,r,n,o,i,a){var u=e+(r^(t|~n))+(o>>>0)+a;return(u<<i|u>>>32-i)+t},i._blocksize=16,i._digestsize=16,e.exports=function(e,r){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var n=t.wordsToBytes(i(e,r));return r&&r.asBytes?n:r&&r.asString?o.bytesToString(n):t.bytesToHex(n)}}()}),H={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},K=function(e){throw{name:"SyntaxError",message:e,at:P,text:N}},V=function(e){return e&&e!==B&&K("Expected '"+e+"' instead of '"+B+"'"),B=N.charAt(P),P+=1,B},Z=function(){var e,t="";for("-"===B&&(t="-",V("-"));B>="0"&&B<="9";)t+=B,V();if("."===B)for(t+=".";V()&&B>="0"&&B<="9";)t+=B;if("e"===B||"E"===B)for(t+=B,V(),"-"!==B&&"+"!==B||(t+=B,V());B>="0"&&B<="9";)t+=B,V();if(e=+t,isFinite(e))return e;K("Bad number")},G=function(){var e,t,r,n="";if('"'===B)for(;V();){if('"'===B)return V(),n;if("\\"===B)if(V(),"u"===B){for(r=0,t=0;t<4&&(e=parseInt(V(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof H[B])break;n+=H[B]}else n+=B}K("Bad string")},W=function(){for(;B&&B<=" ";)V()},X=function(){switch(B){case"t":return V("t"),V("r"),V("u"),V("e"),!0;case"f":return V("f"),V("a"),V("l"),V("s"),V("e"),!1;case"n":return V("n"),V("u"),V("l"),V("l"),null}K("Unexpected '"+B+"'")},Q=function(){var e=[];if("["===B){if(V("["),W(),"]"===B)return V("]"),e;for(;B;){if(e.push(R()),W(),"]"===B)return V("]"),e;V(","),W()}}K("Bad array")},Y=function(){var e,t={};if("{"===B){if(V("{"),W(),"}"===B)return V("}"),t;for(;B;){if(e=G(),W(),V(":"),Object.hasOwnProperty.call(t,e)&&K('Duplicate key "'+e+'"'),t[e]=R(),W(),"}"===B)return V("}"),t;V(","),W()}}K("Bad object")};R=function(){switch(W(),B){case"{":return Y();case"[":return Q();case'"':return G();case"-":return Z();default:return B>="0"&&B<="9"?Z():X()}};var $,ee,te,re=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,ne={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},oe={parse:function(e,t){var r;return N=e,P=0,B=" ",r=R(),W(),B&&K("Syntax error"),"function"==typeof t?function e(r,n){var o,i,a=r[n];if(a&&"object"===(void 0===a?"undefined":j(a)))for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(void 0!==(i=e(a,o))?a[o]=i:delete a[o]);return t.call(r,n,a)}({"":r},""):r},stringify:function(e,t,r){var n;if($="",ee="","number"==typeof r)for(n=0;n<r;n+=1)ee+=" ";else"string"==typeof r&&(ee=r);if(te=t,t&&"function"!=typeof t&&("object"!==(void 0===t?"undefined":j(t))||"number"!=typeof t.length))throw new Error("JSON.stringify");return l("",{"":e})}},ie="undefined"!=typeof JSON?JSON:oe,ae=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var n="boolean"==typeof t.cycles&&t.cycles,o=t.replacer||function(e,t){return t},i=t.cmp&&function(e){return function(t){return function(r,n){var o={key:r,value:t[r]},i={key:n,value:t[n]};return e(o,i)}}}(t.cmp),a=[];return function e(t,u,s,c){var f=r?"\n"+new Array(c+1).join(r):"",l=r?": ":":";if(s&&s.toJSON&&"function"==typeof s.toJSON&&(s=s.toJSON()),void 0!==(s=o.call(t,u,s))){if("object"!==(void 0===s?"undefined":j(s))||null===s)return ie.stringify(s);if(ue(s)){for(var p=[],h=0;h<s.length;h++){var y=e(s,h,s[h],c+1)||ie.stringify(null);p.push(f+r+y)}return"["+p.join(",")+f+"]"}if(-1!==a.indexOf(s)){if(n)return ie.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}a.push(s);for(var v=se(s).sort(i&&i(s)),p=[],h=0;h<v.length;h++){var d=e(s,u=v[h],s[u],c+1);if(d){var g=ie.stringify(u)+l+d;p.push(f+r+g)}}return a.splice(a.indexOf(s),1),"{"+p.join(",")+f+"}"}}({"":e},"",e,0)},ue=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},se=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r};Object.setPrototypeOf(p,Error),(p.prototype=Object.create(Error.prototype)).name="ImplementationError",p.prototype.message="",p.prototype.constructor=p;var ce=o("Multiton"),fe=function(){function e(t){if(S(this,e),this.constructor.has(t))throw new Error('Attempt to create multiple instances for key "'+t+'"')}return x(e,null,[{key:"has",value:function(e){var t=ce(this);if(void 0===t.instances)return!1;var r=this.coerceKey(e);return void 0!==t.instances[r]}},{key:"for",value:function(e){var t=ce(this);t.instances||(t.instances=new Map);var r=this.coerceKey(e);if(t.instances.has(r))return t.instances.get(r);for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var a=this.new.apply(this,[r].concat(o));return t.instances.set(r,a),a}},{key:"new",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat([e],r)))}},{key:"coerceKey",value:function(e){return e}}]),e}(),le=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},pe=Object.prototype.hasOwnProperty,he={stringify:function(e,t){var r=[];"string"!=typeof(t=t||"")&&(t="?");for(var n in e)pe.call(e,n)&&r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return r.length?t+r.join("&"):""},parse:function(e){for(var t,r=/([^=?&]+)=?([^&]*)/g,n={};t=r.exec(e);n[h(t[1])]=h(t[2]));return n}},ye=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,ve=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,de=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ge={hash:1,query:1};g.prototype={set:function(e,t,r){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||he.parse)(t)),n[e]=t;break;case"port":n[e]=t,le(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,/:\d+$/.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":n.pathname=t.length&&"/"!==t.charAt(0)?"/"+t:t;break;default:n[e]=t}for(var o=0;o<de.length;o++){var i=de[o];i[4]&&(n[i[1]]=n[i[1]].toLowerCase())}return n.origin=n.protocol&&n.host&&"file:"!==n.protocol?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=he.stringify);var t,r=this,n=r.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var o=n+(r.slashes?"//":"");return r.username&&(o+=r.username,r.password&&(o+=":"+r.password),o+="@"),o+=r.host+r.pathname,(t="object"===j(r.query)?e(r.query):r.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(o+=r.hash),o}},g.extractProtocol=v,g.location=y,g.qs=he;var we,be=g,me={text:function(){var e=A.apply(void 0,arguments),t=O(e,2),r=t[0],n=t[1];return n.type="text",m(r,n)},json:function(){var e=A.apply(void 0,arguments),t=O(e,2),r=t[0],n=t[1];return n.type="json",m(r,n)},buffer:function(){var e=A.apply(void 0,arguments),t=O(e,2),r=t[0],n=t[1];return n.type="arraybuffer",n.encoding=null,m(r,n)},csv:function(){var e=A.apply(void 0,arguments),t=O(e,2),r=t[0],n=t[1];return this.text(r,n).then(function(e){return _.self.d3.csvParse(e,n.row)})},tsv:function(){var e=A.apply(void 0,arguments),t=O(e,2),r=t[0],n=t[1];return this.text(r,n).then(function(e){return _.self.d3.tsvParse(e,n.row)})}},Ae=o("Semaphore"),je=function e(t,r){var n=this;S(this,e);var o=[new Promise(function(e,t){n.resolve=e,n.reject=t}),new Promise(function(e){n.let=e}).then(function(){r(n.resolve,n.reject)})];this.promise=Promise.all(o).then(function(e){return t.signal(),e[0]},function(e){return t.signal(),Promise.reject(e)})},Se=function(){function e(t){S(this,e);var r=Ae(this);r.capacity=t,r.available=t,r.queue=[]}return x(e,[{key:"wait",value:function(e){var t=Ae(this),r=new je(this,e);return 0===t.available?t.queue.push(r):(--t.available,r.let()),r.promise}},{key:"signal",value:function(){var e=Ae(this);0===e.queue.length?++e.available:e.queue.shift().let()}},{key:"capacity",get:function(){return Ae(this).capacity}},{key:"available",get:function(){return Ae(this).available}}]),e}(),xe=o("Singleton"),Oe=function(){function e(){if(S(this,e),void 0!==xe(this.constructor).instance)throw new Error("Attempt to create multiple instances for singleton")}return x(e,null,[{key:"get",value:function(){var e=xe(this);return void 0===e.instance&&(e.instance=this.new.apply(this,arguments)),e.instance}},{key:"new",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(this,[null].concat(t)))}}]),e}(),ke={forEach:function(e,t,r){var n=[];e.forEach(function(e,o){var i=o%t;n[i]=e,i===t-1&&r(n,Math.floor(o/t))})},some:function(e,t,r){var n=[];return e.some(function(e,o){var i=o%t;return n[i]=e,i===t-1&&r(n,Math.floor(o/t))})},every:function(e,t,r){var n=[];return e.every(function(e,o){var i=o%t;return n[i]=e,i!==t-1||r(n,Math.floor(o/t))})},reduce:function(e,t,r,n){var o=[];return e.reduce(function(e,n,i){var a=i%t;return o[a]=n,a===t-1?r(e,o,Math.floor(i/t)):e},n)},transform:function(e,t,r){var n=[];return e.forEach(function(o,i){var a=i%t;if(n[a]=o,a===t-1)for(var u=r(n,Math.floor(i/t)),s=0;s<t;++s)e[i-(t-s-1)]=u[s]}),e}},Ee=u(function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),o=n.length,i="";for(r=0;r<o;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,o,i,a,u=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(u--,"="===e[e.length-2]&&u--);var f=new ArrayBuffer(u),l=new Uint8Array(f);for(t=0;t<s;t+=4)n=r[e.charCodeAt(t)],o=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],a=r[e.charCodeAt(t+3)],l[c++]=n<<2|o>>4,l[c++]=(15&o)<<4|i>>2,l[c++]=(3&i)<<6|63&a;return f}}()}),qe={encode:function(e){var t=_.self.TextEncoder||n.TextEncoder;if(void 0===t)throw new Error("TextEncoder is missing");var r=new t,o=JSON.stringify(e);return r.encode(o).buffer},decode:function(e){var t=_.self.TextDecoder||n.TextDecoder;if(void 0===t)throw new Error("TextDecoder is missing");var r=new t,o=new DataView(e),i=r.decode(o);return JSON.parse(i)},pack:function(e){return Ee.encode(e)},unpack:function(e){return Ee.decode(e)},packBufferGeometry:function(e){var t=this;Object.values(e.data.attributes).forEach(function(e){var r=new(0,_.self[e.type])(e.array).buffer;e.array=t.pack(r)})},unpackBufferGeometry:function(e){var t=this;Object.values(e.data.attributes).forEach(function(e){var r=_.self[e.type],n=t.unpack(e.array);e.array=Array.from(new r(n))})}},Te=U.crypto||U.msCrypto;if(Te&&Te.getRandomValues){var Ce=new Uint8Array(16);we=function(){return Te.getRandomValues(Ce),Ce}}if(!we){var Pe=new Array(16);we=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),Pe[t]=e>>>((3&t)<<3)&255;return Pe}}for(var Be=we,Ne=[],Re=0;Re<256;++Re)Ne[Re]=(Re+256).toString(16).substr(1);var _e=function(e,t){var r=t||0,n=Ne;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]},Fe=Be(),Me=[1|Fe[0],Fe[1],Fe[2],Fe[3],Fe[4],Fe[5]],Ue=16383&(Fe[6]<<8|Fe[7]),Ie=0,Je=0,Le=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||Be)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||_e(o)},De=Le;De.v1=function(e,t,r){var n=t&&r||0,o=t||[],i=void 0!==(e=e||{}).clockseq?e.clockseq:Ue,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:Je+1,s=a-Ie+(u-Je)/1e4;if(s<0&&void 0===e.clockseq&&(i=i+1&16383),(s<0||a>Ie)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ie=a,Je=u,Ue=i;var c=(1e4*(268435455&(a+=122192928e5))+u)%4294967296;o[n++]=c>>>24&255,o[n++]=c>>>16&255,o[n++]=c>>>8&255,o[n++]=255&c;var f=a/4294967296*1e4&268435455;o[n++]=f>>>8&255,o[n++]=255&f,o[n++]=f>>>24&15|16,o[n++]=f>>>16&255,o[n++]=i>>>8|128,o[n++]=255&i;for(var l=e.node||Me,p=0;p<6;++p)o[n+p]=l[p];return t||_e(o)},De.v4=Le;var ze=De;e.Aggregate=C,e.AggregateFunction=q,e.AssertionError=i,e.Environment=_,e.FilePath=M,e.Hash=function(e){return z(ae(e))},e.ImplementationError=p,e.Multiton=fe,e.Namespace=o,e.Request=me,e.Semaphore=Se,e.Singleton=Oe,e.Stride=ke,e.Transferral=qe,e.URL=be,e.UUID=function(){return ze.v4()},Object.defineProperty(e,"__esModule",{value:!0})});