!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs"),require("request"),require("text-encoding")):"function"==typeof define&&define.amd?define(["exports","fs","request","text-encoding"],e):e(t.Planck=t.Planck||{},t.fs,t.request,t.encoding)}(this,function(t,e,r,n){"use strict";function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=Symbol(t);return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t};return void 0===t[e]&&(t[e]=r({})),t[e]}}function i(t){this.message=t}function a(){switch(_.type){case"browser":var t=document.currentScript||document._currentScript;return t?t.src:null;case"worker":return self.location.href;case"node":return __filename}throw new Error}function u(t,e){return e={exports:{}},t(e,e.exports),e.exports}function s(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function c(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&s(t.slice(0,0))}function f(t){return rt.lastIndex=0,rt.test(t)?'"'+t.replace(rt,function(t){var e=nt[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function l(t,e){var r,n,o,i,a,u=$,s=e[t];switch(s&&"object"===(void 0===s?"undefined":j(s))&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof et&&(s=et.call(e,t,s)),void 0===s?"undefined":j(s)){case"string":return f(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if($+=tt,a=[],"[object Array]"===Object.prototype.toString.apply(s)){for(i=s.length,r=0;r<i;r+=1)a[r]=l(r,s)||"null";return o=0===a.length?"[]":$?"[\n"+$+a.join(",\n"+$)+"\n"+u+"]":"["+a.join(",")+"]",$=u,o}if(et&&"object"===(void 0===et?"undefined":j(et)))for(i=et.length,r=0;r<i;r+=1)"string"==typeof(n=et[r])&&(o=l(n,s))&&a.push(f(n)+($?": ":":")+o);else for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(o=l(n,s))&&a.push(f(n)+($?": ":":")+o);return o=0===a.length?"{}":$?"{\n"+$+a.join(",\n"+$)+"\n"+u+"}":"{"+a.join(",")+"}",$=u,o}}function p(t){this.message=t}function h(t){return decodeURIComponent(t.replace(/\+/g," "))}function y(t){var e,r={},n=void 0===(t=t||U.location||{})?"undefined":j(t);if("blob:"===t.protocol)r=new g(unescape(t.pathname),{});else if("string"===n){r=new g(t,{});for(e in gt)delete r[e]}else if("object"===n){for(e in t)e in gt||(r[e]=t[e]);void 0===r.slashes&&(r.slashes=vt.test(t.href))}return r}function v(t){var e=yt.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function d(t,e){for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),n=r.length,o=r[n-1],i=!1,a=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),a++):a&&(0===n&&(i=!0),r.splice(n,1),a--);return i&&r.unshift(""),"."!==o&&".."!==o||r.push(""),r.join("/")}function g(t,e,r){if(!(this instanceof g))return new g(t,e,r);var n,o,i,a,u,s,c=dt.slice(),f=void 0===e?"undefined":j(e),l=this,p=0;for("object"!==f&&"string"!==f&&(r=e,e=null),r&&"function"!=typeof r&&(r=ht.parse),e=y(e),n=!(o=v(t||"")).protocol&&!o.slashes,l.slashes=o.slashes||n&&e.slashes,l.protocol=o.protocol||e.protocol||"",t=o.rest,o.slashes||(c[2]=[/(.*)/,"pathname"]);p<c.length;p++)i=(a=c[p])[0],s=a[1],i!==i?l[s]=t:"string"==typeof i?~(u=t.indexOf(i))&&("number"==typeof a[2]?(l[s]=t.slice(0,u),t=t.slice(u+a[2])):(l[s]=t.slice(u),t=t.slice(0,u))):(u=i.exec(t))&&(l[s]=u[1],t=t.slice(0,u.index)),l[s]=l[s]||(n&&a[3]?e[s]||"":""),a[4]&&(l[s]=l[s].toLowerCase());r&&(l.query=r(l.query)),n&&e.slashes&&"/"!==l.pathname.charAt(0)&&(""!==l.pathname||""!==e.pathname)&&(l.pathname=d(l.pathname,e.pathname)),lt(l.port,l.protocol)||(l.host=l.hostname,l.port=""),l.username=l.password="",l.auth&&(a=l.auth.split(":"),l.username=a[0]||"",l.password=a[1]||""),l.origin=l.protocol&&l.host&&"file:"!==l.protocol?l.protocol+"//"+l.host:"null",l.href=l.toString()}function w(t,e){return new Promise(function(r,n){var o=new bt(t,!0);e.query&&o.set("query",Object.assign({},o.query,e.query));var i=new XMLHttpRequest;i.open("get",o.toString(),!0),e.headers&&Object.entries(e.headers).forEach(function(t){i.setRequestHeader.apply(i,k(t))}),i.responseType=e.type,i.addEventListener("loadend",function(t){i.status<200||i.status>=300?n(i.status):null!==i.response||"json"!==e.type?r(i.response):n(new Error("Could not parse JSON"))},!1),i.send()})}function b(t,n){return n.local?new Promise(function(r,o){e.readFile(t,n.encoding,function(t,e){t?o(t):r(e)})}):new Promise(function(e,o){r({url:t,headers:n.headers||{},qs:n.query||{},encoding:n.encoding},function(t,r){t?o(t):((r.statusCode<200||r.statusCode>=300)&&o(r.statusCode),e(r.body))})})}function m(t,e){if("node"===_.type){var r=b(t,e);return"json"===e.type?r.then(function(t){if("string"!=typeof t)throw new Error("Response is unexpectedly not a string");return JSON.parse(t)}):"arraybuffer"===e.type?r.then(function(t){if(!(t instanceof Buffer))throw new Error("Response is unexpectedly not a buffer");for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;++n)r[n]=t[n];return e}):r}return w(t,e)}function A(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],o=e[1];if("string"!=typeof n&&(n=(o=n).url),"string"!=typeof n)throw new Error("The first argument or options.url must be a string");return o=Object.assign({},{type:"text",local:!1,encoding:"utf-8"},o),[n,o]}r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},O=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),x=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},E=o("AggregateFunction"),q=function(){function t(e){if(S(this,t),e!==E)throw new Error;for(var r=E(this),n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];r.targets=o}return O(t,[{key:"apply",value:function(t,e,r){return E(this).targets.map(function(t){return Reflect.apply(t,e,r)})}},{key:"getPrototypeOf",value:function(t){return this.constructor.prototype}}],[{key:"new",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=new(Function.prototype.bind.apply(this,[null].concat([E],e)));return new Proxy(function(){},n)}}]),t}(),T=o("Aggregate"),C=function(){function t(e){if(S(this,t),e!==T)throw new Error;for(var r=T(this),n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];r.targets=o}return O(t,[{key:"set",value:function(t,e,r,n){return T(this).targets.forEach(function(t){Reflect.set(t,e,r)}),Reflect.set(t,e,r,n)}},{key:"get",value:function(t,e,r){var n=T(this);return n.targets.every(function(t){return"function"==typeof Reflect.get(t,e)})?q.new.apply(q,k(n.targets.map(function(t){return Reflect.get(t,e).bind(t)}))):Reflect.get(n.targets[0],e,r)}},{key:"getPrototypeOf",value:function(t){return this.constructor.prototype}}],[{key:"new",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=new(Function.prototype.bind.apply(this,[null].concat([T],e)));return new Proxy({},n)}}]),t}();Object.setPrototypeOf(i,Error),(i.prototype=Object.create(Error.prototype)).name="AssertionError",i.prototype.message="",i.prototype.constructor=i;var P,B,N,R,_={get type(){try{if(new Function("return this === window")())return"browser"}catch(t){}try{if(new Function("return this === self")())return"worker"}catch(t){}try{if(new Function("return this === global")())return"node"}catch(t){}throw new Error},get self(){switch(this.type){case"browser":return window;case"worker":return self;case"node":return global}throw new Error}},F=a(),M={get self(){return F},get current(){return a()}},U="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=u(function(t){!function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&r.rotl(t,8)|4278255360&r.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=r.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,n=0;r<t.length;r++,n+=8)e[n>>>5]|=t[r]<<24-n%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var r=[],n=0;n<t.length;n+=3)for(var o=t[n]<<16|t[n+1]<<8|t[n+2],i=0;i<4;i++)8*n+6*i<=8*t.length?r.push(e.charAt(o>>>6*(3-i)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,o=0;n<t.length;o=++n%4)0!=o&&r.push((e.indexOf(t.charAt(n-1))&Math.pow(2,-2*o+8)-1)<<2*o|e.indexOf(t.charAt(n))>>>6-2*o);return r}};t.exports=r}()}),J={utf8:{stringToBytes:function(t){return J.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(J.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}},L=J,z=function(t){return null!=t&&(s(t)||c(t)||!!t._isBuffer)},D=u(function(t){!function(){var e=I,r=L.utf8,n=z,o=L.bin,i=function t(i,a){i.constructor==String?i=a&&"binary"===a.encoding?o.stringToBytes(i):r.stringToBytes(i):n(i)?i=Array.prototype.slice.call(i,0):Array.isArray(i)||(i=i.toString());for(var u=e.bytesToWords(i),s=8*i.length,c=1732584193,f=-271733879,l=-1732584194,p=271733878,h=0;h<u.length;h++)u[h]=16711935&(u[h]<<8|u[h]>>>24)|4278255360&(u[h]<<24|u[h]>>>8);u[s>>>5]|=128<<s%32,u[14+(s+64>>>9<<4)]=s;for(var y=t._ff,v=t._gg,d=t._hh,g=t._ii,h=0;h<u.length;h+=16){var w=c,b=f,m=l,A=p;f=g(f=g(f=g(f=g(f=d(f=d(f=d(f=d(f=v(f=v(f=v(f=v(f=y(f=y(f=y(f=y(f,l=y(l,p=y(p,c=y(c,f,l,p,u[h+0],7,-680876936),f,l,u[h+1],12,-389564586),c,f,u[h+2],17,606105819),p,c,u[h+3],22,-1044525330),l=y(l,p=y(p,c=y(c,f,l,p,u[h+4],7,-176418897),f,l,u[h+5],12,1200080426),c,f,u[h+6],17,-1473231341),p,c,u[h+7],22,-45705983),l=y(l,p=y(p,c=y(c,f,l,p,u[h+8],7,1770035416),f,l,u[h+9],12,-1958414417),c,f,u[h+10],17,-42063),p,c,u[h+11],22,-1990404162),l=y(l,p=y(p,c=y(c,f,l,p,u[h+12],7,1804603682),f,l,u[h+13],12,-40341101),c,f,u[h+14],17,-1502002290),p,c,u[h+15],22,1236535329),l=v(l,p=v(p,c=v(c,f,l,p,u[h+1],5,-165796510),f,l,u[h+6],9,-1069501632),c,f,u[h+11],14,643717713),p,c,u[h+0],20,-373897302),l=v(l,p=v(p,c=v(c,f,l,p,u[h+5],5,-701558691),f,l,u[h+10],9,38016083),c,f,u[h+15],14,-660478335),p,c,u[h+4],20,-405537848),l=v(l,p=v(p,c=v(c,f,l,p,u[h+9],5,568446438),f,l,u[h+14],9,-1019803690),c,f,u[h+3],14,-187363961),p,c,u[h+8],20,1163531501),l=v(l,p=v(p,c=v(c,f,l,p,u[h+13],5,-1444681467),f,l,u[h+2],9,-51403784),c,f,u[h+7],14,1735328473),p,c,u[h+12],20,-1926607734),l=d(l,p=d(p,c=d(c,f,l,p,u[h+5],4,-378558),f,l,u[h+8],11,-2022574463),c,f,u[h+11],16,1839030562),p,c,u[h+14],23,-35309556),l=d(l,p=d(p,c=d(c,f,l,p,u[h+1],4,-1530992060),f,l,u[h+4],11,1272893353),c,f,u[h+7],16,-155497632),p,c,u[h+10],23,-1094730640),l=d(l,p=d(p,c=d(c,f,l,p,u[h+13],4,681279174),f,l,u[h+0],11,-358537222),c,f,u[h+3],16,-722521979),p,c,u[h+6],23,76029189),l=d(l,p=d(p,c=d(c,f,l,p,u[h+9],4,-640364487),f,l,u[h+12],11,-421815835),c,f,u[h+15],16,530742520),p,c,u[h+2],23,-995338651),l=g(l,p=g(p,c=g(c,f,l,p,u[h+0],6,-198630844),f,l,u[h+7],10,1126891415),c,f,u[h+14],15,-1416354905),p,c,u[h+5],21,-57434055),l=g(l,p=g(p,c=g(c,f,l,p,u[h+12],6,1700485571),f,l,u[h+3],10,-1894986606),c,f,u[h+10],15,-1051523),p,c,u[h+1],21,-2054922799),l=g(l,p=g(p,c=g(c,f,l,p,u[h+8],6,1873313359),f,l,u[h+15],10,-30611744),c,f,u[h+6],15,-1560198380),p,c,u[h+13],21,1309151649),l=g(l,p=g(p,c=g(c,f,l,p,u[h+4],6,-145523070),f,l,u[h+11],10,-1120210379),c,f,u[h+2],15,718787259),p,c,u[h+9],21,-343485551),c=c+w>>>0,f=f+b>>>0,l=l+m>>>0,p=p+A>>>0}return e.endian([c,f,l,p])};i._ff=function(t,e,r,n,o,i,a){var u=t+(e&r|~e&n)+(o>>>0)+a;return(u<<i|u>>>32-i)+e},i._gg=function(t,e,r,n,o,i,a){var u=t+(e&n|r&~n)+(o>>>0)+a;return(u<<i|u>>>32-i)+e},i._hh=function(t,e,r,n,o,i,a){var u=t+(e^r^n)+(o>>>0)+a;return(u<<i|u>>>32-i)+e},i._ii=function(t,e,r,n,o,i,a){var u=t+(r^(e|~n))+(o>>>0)+a;return(u<<i|u>>>32-i)+e},i._blocksize=16,i._digestsize=16,t.exports=function(t,r){if(void 0===t||null===t)throw new Error("Illegal argument "+t);var n=e.wordsToBytes(i(t,r));return r&&r.asBytes?n:r&&r.asString?o.bytesToString(n):e.bytesToHex(n)}}()}),H={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},K=function(t){throw{name:"SyntaxError",message:t,at:P,text:N}},V=function(t){return t&&t!==B&&K("Expected '"+t+"' instead of '"+B+"'"),B=N.charAt(P),P+=1,B},Z=function(){var t,e="";for("-"===B&&(e="-",V("-"));B>="0"&&B<="9";)e+=B,V();if("."===B)for(e+=".";V()&&B>="0"&&B<="9";)e+=B;if("e"===B||"E"===B)for(e+=B,V(),"-"!==B&&"+"!==B||(e+=B,V());B>="0"&&B<="9";)e+=B,V();if(t=+e,isFinite(t))return t;K("Bad number")},G=function(){var t,e,r,n="";if('"'===B)for(;V();){if('"'===B)return V(),n;if("\\"===B)if(V(),"u"===B){for(r=0,e=0;e<4&&(t=parseInt(V(),16),isFinite(t));e+=1)r=16*r+t;n+=String.fromCharCode(r)}else{if("string"!=typeof H[B])break;n+=H[B]}else n+=B}K("Bad string")},W=function(){for(;B&&B<=" ";)V()},X=function(){switch(B){case"t":return V("t"),V("r"),V("u"),V("e"),!0;case"f":return V("f"),V("a"),V("l"),V("s"),V("e"),!1;case"n":return V("n"),V("u"),V("l"),V("l"),null}K("Unexpected '"+B+"'")},Q=function(){var t=[];if("["===B){if(V("["),W(),"]"===B)return V("]"),t;for(;B;){if(t.push(R()),W(),"]"===B)return V("]"),t;V(","),W()}}K("Bad array")},Y=function(){var t,e={};if("{"===B){if(V("{"),W(),"}"===B)return V("}"),e;for(;B;){if(t=G(),W(),V(":"),Object.hasOwnProperty.call(e,t)&&K('Duplicate key "'+t+'"'),e[t]=R(),W(),"}"===B)return V("}"),e;V(","),W()}}K("Bad object")};R=function(){switch(W(),B){case"{":return Y();case"[":return Q();case'"':return G();case"-":return Z();default:return B>="0"&&B<="9"?Z():X()}};var $,tt,et,rt=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,nt={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},ot={parse:function(t,e){var r;return N=t,P=0,B=" ",r=R(),W(),B&&K("Syntax error"),"function"==typeof e?function t(r,n){var o,i,a=r[n];if(a&&"object"===(void 0===a?"undefined":j(a)))for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(void 0!==(i=t(a,o))?a[o]=i:delete a[o]);return e.call(r,n,a)}({"":r},""):r},stringify:function(t,e,r){var n;if($="",tt="","number"==typeof r)for(n=0;n<r;n+=1)tt+=" ";else"string"==typeof r&&(tt=r);if(et=e,e&&"function"!=typeof e&&("object"!==(void 0===e?"undefined":j(e))||"number"!=typeof e.length))throw new Error("JSON.stringify");return l("",{"":t})}},it="undefined"!=typeof JSON?JSON:ot,at=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var r=e.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var n="boolean"==typeof e.cycles&&e.cycles,o=e.replacer||function(t,e){return e},i=e.cmp&&function(t){return function(e){return function(r,n){var o={key:r,value:e[r]},i={key:n,value:e[n]};return t(o,i)}}}(e.cmp),a=[];return function t(e,u,s,c){var f=r?"\n"+new Array(c+1).join(r):"",l=r?": ":":";if(s&&s.toJSON&&"function"==typeof s.toJSON&&(s=s.toJSON()),void 0!==(s=o.call(e,u,s))){if("object"!==(void 0===s?"undefined":j(s))||null===s)return it.stringify(s);if(ut(s)){for(var p=[],h=0;h<s.length;h++){var y=t(s,h,s[h],c+1)||it.stringify(null);p.push(f+r+y)}return"["+p.join(",")+f+"]"}if(-1!==a.indexOf(s)){if(n)return it.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}a.push(s);for(var v=st(s).sort(i&&i(s)),p=[],h=0;h<v.length;h++){var d=t(s,u=v[h],s[u],c+1);if(d){var g=it.stringify(u)+l+d;p.push(f+r+g)}}return a.splice(a.indexOf(s),1),"{"+p.join(",")+f+"}"}}({"":t},"",t,0)},ut=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},st=Object.keys||function(t){var e=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in t)e.call(t,n)&&r.push(n);return r};Object.setPrototypeOf(p,Error),(p.prototype=Object.create(Error.prototype)).name="ImplementationError",p.prototype.message="",p.prototype.constructor=p;var ct=o("Multiton"),ft=function(){function t(e){if(S(this,t),this.constructor.has(e))throw new Error('Attempt to create multiple instances for key "'+e+'"')}return O(t,null,[{key:"has",value:function(t){var e=ct(this);if(void 0===e.instances)return!1;var r=this.coerceKey(t);return void 0!==e.instances[r]}},{key:"for",value:function(t){var e=ct(this);e.instances||(e.instances=new Map);var r=this.coerceKey(t);if(e.instances.has(r))return e.instances.get(r);for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var a=this.new.apply(this,[r].concat(o));return e.instances.set(r,a),a}},{key:"new",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat([t],r)))}},{key:"coerceKey",value:function(t){return t}}]),t}(),lt=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t},pt=Object.prototype.hasOwnProperty,ht={stringify:function(t,e){var r=[];"string"!=typeof(e=e||"")&&(e="?");for(var n in t)pt.call(t,n)&&r.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return r.length?e+r.join("&"):""},parse:function(t){for(var e,r=/([^=?&]+)=?([^&]*)/g,n={};e=r.exec(t);n[h(e[1])]=h(e[2]));return n}},yt=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,vt=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,dt=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],gt={hash:1,query:1};g.prototype={set:function(t,e,r){var n=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(r||ht.parse)(e)),n[t]=e;break;case"port":n[t]=e,lt(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[t]="");break;case"hostname":n[t]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[t]=e,/:\d+$/.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!r;break;case"pathname":n.pathname=e.length&&"/"!==e.charAt(0)?"/"+e:e;break;default:n[t]=e}for(var o=0;o<dt.length;o++){var i=dt[o];i[4]&&(n[i[1]]=n[i[1]].toLowerCase())}return n.origin=n.protocol&&n.host&&"file:"!==n.protocol?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(t){t&&"function"==typeof t||(t=ht.stringify);var e,r=this,n=r.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var o=n+(r.slashes?"//":"");return r.username&&(o+=r.username,r.password&&(o+=":"+r.password),o+="@"),o+=r.host+r.pathname,(e="object"===j(r.query)?t(r.query):r.query)&&(o+="?"!==e.charAt(0)?"?"+e:e),r.hash&&(o+=r.hash),o}},g.extractProtocol=v,g.location=y,g.qs=ht;var wt,bt=g,mt={text:function(){var t=A.apply(void 0,arguments),e=x(t,2),r=e[0],n=e[1];return n.type="text",m(r,n)},json:function(){var t=A.apply(void 0,arguments),e=x(t,2),r=e[0],n=e[1];return n.type="json",m(r,n)},buffer:function(){var t=A.apply(void 0,arguments),e=x(t,2),r=e[0],n=e[1];return n.type="arraybuffer",n.encoding=null,m(r,n)},csv:function(){var t=A.apply(void 0,arguments),e=x(t,2),r=e[0],n=e[1];return this.text(r,n).then(function(t){return _.self.d3.csvParse(t,n.row)})},tsv:function(){var t=A.apply(void 0,arguments),e=x(t,2),r=e[0],n=e[1];return this.text(r,n).then(function(t){return _.self.d3.tsvParse(t,n.row)})}},At=o("Semaphore"),jt=function t(e,r){var n=this;S(this,t);var o=[new Promise(function(t,e){n.resolve=t,n.reject=e}),new Promise(function(t){n.let=t}).then(function(){r(n.resolve,n.reject)})];this.promise=Promise.all(o).then(function(t){return e.signal(),t[0]},function(t){return e.signal(),Promise.reject(t)})},St=function(){function t(e){S(this,t);var r=At(this);r.capacity=e,r.available=e,r.queue=[]}return O(t,[{key:"wait",value:function(t){var e=At(this),r=new jt(this,t);return 0===e.available?e.queue.push(r):(--e.available,r.let()),r.promise}},{key:"signal",value:function(){var t=At(this);0===t.queue.length?++t.available:t.queue.shift().let()}},{key:"capacity",get:function(){return At(this).capacity}},{key:"available",get:function(){return At(this).available}}]),t}(),Ot=o("Singleton"),xt=function(){function t(){if(S(this,t),void 0!==Ot(this.constructor).instance)throw new Error("Attempt to create multiple instances for singleton")}return O(t,null,[{key:"get",value:function(){var t=Ot(this);return void 0===t.instance&&(t.instance=this.new.apply(this,arguments)),t.instance}},{key:"new",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return new(Function.prototype.bind.apply(this,[null].concat(e)))}}]),t}(),kt={forEach:function(t,e,r){var n=[];t.forEach(function(t,o){var i=o%e;n[i]=t,i===e-1&&r(n,Math.floor(o/e))})},some:function(t,e,r){var n=[];return t.some(function(t,o){var i=o%e;return n[i]=t,i===e-1&&r(n,Math.floor(o/e))})},every:function(t,e,r){var n=[];return t.every(function(t,o){var i=o%e;return n[i]=t,i!==e-1||r(n,Math.floor(o/e))})},reduce:function(t,e,r,n){var o=[];return t.reduce(function(t,n,i){var a=i%e;return o[a]=n,a===e-1?r(t,o,Math.floor(i/e)):t},n)},transform:function(t,e,r){var n=[];return t.forEach(function(o,i){var a=i%e;if(n[a]=o,a===e-1)for(var u=r(n,Math.floor(i/e)),s=0;s<e;++s)t[i-(e-s-1)]=u[s]}),t}},Et=u(function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),o=n.length,i="";for(r=0;r<o;r+=3)i+=t[n[r]>>2],i+=t[(3&n[r])<<4|n[r+1]>>4],i+=t[(15&n[r+1])<<2|n[r+2]>>6],i+=t[63&n[r+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,n,o,i,a,u=.75*t.length,s=t.length,c=0;"="===t[t.length-1]&&(u--,"="===t[t.length-2]&&u--);var f=new ArrayBuffer(u),l=new Uint8Array(f);for(e=0;e<s;e+=4)n=r[t.charCodeAt(e)],o=r[t.charCodeAt(e+1)],i=r[t.charCodeAt(e+2)],a=r[t.charCodeAt(e+3)],l[c++]=n<<2|o>>4,l[c++]=(15&o)<<4|i>>2,l[c++]=(3&i)<<6|63&a;return f}}()}),qt={encode:function(t){var e=new(_.self.TextEncoder||n.TextEncoder),r=JSON.stringify(t);return e.encode(r).buffer},decode:function(t){var e=new(_.self.TextDecoder||n.TextDecoder),r=new DataView(t),o=e.decode(r);return JSON.parse(o)},pack:function(t){return Et.encode(t)},unpack:function(t){return Et.decode(t)},packBufferGeometry:function(t){var e=this;Object.values(t.data.attributes).forEach(function(t){var r=new(0,_.self[t.type])(t.array).buffer;t.array=e.pack(r)})},unpackBufferGeometry:function(t){var e=this;Object.values(t.data.attributes).forEach(function(t){var r=_.self[t.type],n=e.unpack(t.array);t.array=Array.from(new r(n))})}},Tt=U.crypto||U.msCrypto;if(Tt&&Tt.getRandomValues){var Ct=new Uint8Array(16);wt=function(){return Tt.getRandomValues(Ct),Ct}}if(!wt){var Pt=new Array(16);wt=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),Pt[e]=t>>>((3&e)<<3)&255;return Pt}}for(var Bt=wt,Nt=[],Rt=0;Rt<256;++Rt)Nt[Rt]=(Rt+256).toString(16).substr(1);var _t=function(t,e){var r=e||0,n=Nt;return n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]},Ft=Bt(),Mt=[1|Ft[0],Ft[1],Ft[2],Ft[3],Ft[4],Ft[5]],Ut=16383&(Ft[6]<<8|Ft[7]),It=0,Jt=0,Lt=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||Bt)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;++i)e[n+i]=o[i];return e||_t(o)},zt=Lt;zt.v1=function(t,e,r){var n=e&&r||0,o=e||[],i=void 0!==(t=t||{}).clockseq?t.clockseq:Ut,a=void 0!==t.msecs?t.msecs:(new Date).getTime(),u=void 0!==t.nsecs?t.nsecs:Jt+1,s=a-It+(u-Jt)/1e4;if(s<0&&void 0===t.clockseq&&(i=i+1&16383),(s<0||a>It)&&void 0===t.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");It=a,Jt=u,Ut=i;var c=(1e4*(268435455&(a+=122192928e5))+u)%4294967296;o[n++]=c>>>24&255,o[n++]=c>>>16&255,o[n++]=c>>>8&255,o[n++]=255&c;var f=a/4294967296*1e4&268435455;o[n++]=f>>>8&255,o[n++]=255&f,o[n++]=f>>>24&15|16,o[n++]=f>>>16&255,o[n++]=i>>>8|128,o[n++]=255&i;for(var l=t.node||Mt,p=0;p<6;++p)o[n+p]=l[p];return e||_t(o)},zt.v4=Lt;var Dt=zt;t.Aggregate=C,t.AggregateFunction=q,t.AssertionError=i,t.Environment=_,t.FilePath=M,t.Hash=function(t){return D(at(t))},t.ImplementationError=p,t.Multiton=ft,t.Namespace=o,t.Request=mt,t.Semaphore=St,t.Singleton=xt,t.Stride=kt,t.Transferral=qt,t.URL=bt,t.UUID=function(){return Dt.v4()},Object.defineProperty(t,"__esModule",{value:!0})});