!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(global.Planck=global.Planck||{})}(this,function(exports){"use strict";function Namespace(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,symbol=Symbol(name);return function namespace(object){var init=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(data){return data};return void 0===object[symbol]&&(object[symbol]=init({})),object[symbol]}}function AssertionError(message){this.message=message}function resolveRelativePath(parts){return parts.reduce(function(result,part){return 0===part.length||"."===part?result:".."===part?(result.pop(),result):[].concat(toConsumableArray(result),[part])},[])}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];switch(value&&"object"===(void 0===value?"undefined":_typeof(value))&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),void 0===value?"undefined":_typeof(value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"===(void 0===rep?"undefined":_typeof(rep)))for(length=rep.length,i=0;i<length;i+=1)"string"==typeof(k=rep[i])&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}function Hash(object){return md5(index$2(object))}function ImplementationError(message){this.message=message}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)},internal$1=Namespace("AggregateFunction"),AggregateFunction=function(){function AggregateFunction(namespace){if(classCallCheck(this,AggregateFunction),namespace!==internal$1)throw new Error;for(var scope=internal$1(this),_len=arguments.length,targets=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)targets[_key-1]=arguments[_key];scope.targets=targets}return createClass(AggregateFunction,[{key:"apply",value:function apply(target,bound,args){return internal$1(this).targets.map(function(target){return Reflect.apply(target,bound,args)})}},{key:"getPrototypeOf",value:function getPrototypeOf(target){return this.constructor.prototype}}],[{key:"new",value:function _new(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var instance=new(Function.prototype.bind.apply(this,[null].concat([internal$1],args)));return new Proxy(function(){},instance)}}]),AggregateFunction}(),internal$$1=Namespace("Aggregate"),Aggregate=function(){function Aggregate(namespace){if(classCallCheck(this,Aggregate),namespace!==internal$$1)throw new Error;for(var scope=internal$$1(this),_len=arguments.length,targets=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)targets[_key-1]=arguments[_key];scope.targets=targets}return createClass(Aggregate,[{key:"set",value:function set$$1(target,property,value,receiver){return internal$$1(this).targets.forEach(function(target){Reflect.set(target,property,value)}),Reflect.set(target,property,value,receiver)}},{key:"get",value:function get$$1(target,property,receiver){var scope=internal$$1(this);return scope.targets.every(function(target){return"function"==typeof Reflect.get(target,property)})?AggregateFunction.new.apply(AggregateFunction,toConsumableArray(scope.targets.map(function(target){return Reflect.get(target,property).bind(target)}))):Reflect.get(scope.targets[0],property,receiver)}},{key:"getPrototypeOf",value:function getPrototypeOf(target){return this.constructor.prototype}}],[{key:"new",value:function _new(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var instance=new(Function.prototype.bind.apply(this,[null].concat([internal$$1],args)));return new Proxy({},instance)}}]),Aggregate}();Object.setPrototypeOf(AssertionError,Error),AssertionError.prototype=Object.create(Error.prototype),AssertionError.prototype.name="AssertionError",AssertionError.prototype.message="",AssertionError.prototype.constructor=AssertionError;var Environment=function(){function Environment(){classCallCheck(this,Environment)}return createClass(Environment,null,[{key:"type",get:function get$$1(){try{if(new Function("return this === window")())return"browser"}catch(error){}try{if(new Function("return this === self")())return"worker"}catch(error){}try{if(new Function("return this === global")())return"node"}catch(error){}throw new Error}},{key:"global",get:function get$$1(){switch(this.type){case"browser":return window;case"worker":return self;case"node":return global}throw new Error}}]),Environment}(),path=void 0;"node"===Environment.type&&(path=require("path"));var FilePath=function(){function FilePath(){classCallCheck(this,FilePath)}return createClass(FilePath,null,[{key:"resolve",value:function resolve(arg){var separator=void 0,root=void 0;"node"!==Environment.type?(separator="/",root=this.self.split("/").slice(0,-2).join("/")+"/"):(separator=path.sep,root="");var first=arg;first.startsWith(root)&&(first=first.substr(root.length));for(var _len=arguments.length,rest=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)rest[_key-1]=arguments[_key];return root+[].concat(toConsumableArray(resolveRelativePath(first.split(separator))),toConsumableArray(resolveRelativePath(rest.reduce(function(parts,part){return[].concat(toConsumableArray(parts),toConsumableArray(part.split(separator)))},[])))).join(separator)}},{key:"self",get:function get$$1(){switch(Environment.type){case"browser":return document.currentScript.src;case"worker":return self.location.href;case"node":return __filename}throw new Error}}]),FilePath}(),crypt=createCommonjsModule(function(module){!function(){var base64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",crypt={rotl:function rotl(n,b){return n<<b|n>>>32-b},rotr:function rotr(n,b){return n<<32-b|n>>>b},endian:function endian(n){if(n.constructor==Number)return 16711935&crypt.rotl(n,8)|4278255360&crypt.rotl(n,24);for(var i=0;i<n.length;i++)n[i]=crypt.endian(n[i]);return n},randomBytes:function randomBytes(n){for(var bytes=[];n>0;n--)bytes.push(Math.floor(256*Math.random()));return bytes},bytesToWords:function bytesToWords(bytes){for(var words=[],i=0,b=0;i<bytes.length;i++,b+=8)words[b>>>5]|=bytes[i]<<24-b%32;return words},wordsToBytes:function wordsToBytes(words){for(var bytes=[],b=0;b<32*words.length;b+=8)bytes.push(words[b>>>5]>>>24-b%32&255);return bytes},bytesToHex:function bytesToHex(bytes){for(var hex=[],i=0;i<bytes.length;i++)hex.push((bytes[i]>>>4).toString(16)),hex.push((15&bytes[i]).toString(16));return hex.join("")},hexToBytes:function hexToBytes(hex){for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return bytes},bytesToBase64:function bytesToBase64(bytes){for(var base64=[],i=0;i<bytes.length;i+=3)for(var triplet=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2],j=0;j<4;j++)8*i+6*j<=8*bytes.length?base64.push(base64map.charAt(triplet>>>6*(3-j)&63)):base64.push("=");return base64.join("")},base64ToBytes:function base64ToBytes(base64){base64=base64.replace(/[^A-Z0-9+\/]/gi,"");for(var bytes=[],i=0,imod4=0;i<base64.length;imod4=++i%4)0!=imod4&&bytes.push((base64map.indexOf(base64.charAt(i-1))&Math.pow(2,-2*imod4+8)-1)<<2*imod4|base64map.indexOf(base64.charAt(i))>>>6-2*imod4);return bytes}};module.exports=crypt}()}),charenc={utf8:{stringToBytes:function stringToBytes(str){return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)))},bytesToString:function bytesToString(bytes){return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)))}},bin:{stringToBytes:function stringToBytes(str){for(var bytes=[],i=0;i<str.length;i++)bytes.push(255&str.charCodeAt(i));return bytes},bytesToString:function bytesToString(bytes){for(var str=[],i=0;i<bytes.length;i++)str.push(String.fromCharCode(bytes[i]));return str.join("")}}},charenc_1=charenc,index=function index(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)},md5=createCommonjsModule(function(module){!function(){var crypt$$1=crypt,utf8=charenc_1.utf8,isBuffer=index,bin=charenc_1.bin,md5=function md5(message,options){message.constructor==String?message=options&&"binary"===options.encoding?bin.stringToBytes(message):utf8.stringToBytes(message):isBuffer(message)?message=Array.prototype.slice.call(message,0):Array.isArray(message)||(message=message.toString());for(var m=crypt$$1.bytesToWords(message),l=8*message.length,a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<m.length;i++)m[i]=16711935&(m[i]<<8|m[i]>>>24)|4278255360&(m[i]<<24|m[i]>>>8);m[l>>>5]|=128<<l%32,m[14+(l+64>>>9<<4)]=l;for(var FF=md5._ff,GG=md5._gg,HH=md5._hh,II=md5._ii,i=0;i<m.length;i+=16){var aa=a,bb=b,cc=c,dd=d;a=FF(a,b,c,d,m[i+0],7,-680876936),d=FF(d,a,b,c,m[i+1],12,-389564586),c=FF(c,d,a,b,m[i+2],17,606105819),b=FF(b,c,d,a,m[i+3],22,-1044525330),a=FF(a,b,c,d,m[i+4],7,-176418897),d=FF(d,a,b,c,m[i+5],12,1200080426),c=FF(c,d,a,b,m[i+6],17,-1473231341),b=FF(b,c,d,a,m[i+7],22,-45705983),a=FF(a,b,c,d,m[i+8],7,1770035416),d=FF(d,a,b,c,m[i+9],12,-1958414417),c=FF(c,d,a,b,m[i+10],17,-42063),b=FF(b,c,d,a,m[i+11],22,-1990404162),a=FF(a,b,c,d,m[i+12],7,1804603682),d=FF(d,a,b,c,m[i+13],12,-40341101),c=FF(c,d,a,b,m[i+14],17,-1502002290),b=FF(b,c,d,a,m[i+15],22,1236535329),a=GG(a,b,c,d,m[i+1],5,-165796510),d=GG(d,a,b,c,m[i+6],9,-1069501632),c=GG(c,d,a,b,m[i+11],14,643717713),b=GG(b,c,d,a,m[i+0],20,-373897302),a=GG(a,b,c,d,m[i+5],5,-701558691),d=GG(d,a,b,c,m[i+10],9,38016083),c=GG(c,d,a,b,m[i+15],14,-660478335),b=GG(b,c,d,a,m[i+4],20,-405537848),a=GG(a,b,c,d,m[i+9],5,568446438),d=GG(d,a,b,c,m[i+14],9,-1019803690),c=GG(c,d,a,b,m[i+3],14,-187363961),b=GG(b,c,d,a,m[i+8],20,1163531501),a=GG(a,b,c,d,m[i+13],5,-1444681467),d=GG(d,a,b,c,m[i+2],9,-51403784),c=GG(c,d,a,b,m[i+7],14,1735328473),b=GG(b,c,d,a,m[i+12],20,-1926607734),a=HH(a,b,c,d,m[i+5],4,-378558),d=HH(d,a,b,c,m[i+8],11,-2022574463),c=HH(c,d,a,b,m[i+11],16,1839030562),b=HH(b,c,d,a,m[i+14],23,-35309556),a=HH(a,b,c,d,m[i+1],4,-1530992060),d=HH(d,a,b,c,m[i+4],11,1272893353),c=HH(c,d,a,b,m[i+7],16,-155497632),b=HH(b,c,d,a,m[i+10],23,-1094730640),a=HH(a,b,c,d,m[i+13],4,681279174),d=HH(d,a,b,c,m[i+0],11,-358537222),c=HH(c,d,a,b,m[i+3],16,-722521979),b=HH(b,c,d,a,m[i+6],23,76029189),a=HH(a,b,c,d,m[i+9],4,-640364487),d=HH(d,a,b,c,m[i+12],11,-421815835),c=HH(c,d,a,b,m[i+15],16,530742520),b=HH(b,c,d,a,m[i+2],23,-995338651),a=II(a,b,c,d,m[i+0],6,-198630844),d=II(d,a,b,c,m[i+7],10,1126891415),c=II(c,d,a,b,m[i+14],15,-1416354905),b=II(b,c,d,a,m[i+5],21,-57434055),a=II(a,b,c,d,m[i+12],6,1700485571),d=II(d,a,b,c,m[i+3],10,-1894986606),c=II(c,d,a,b,m[i+10],15,-1051523),b=II(b,c,d,a,m[i+1],21,-2054922799),a=II(a,b,c,d,m[i+8],6,1873313359),d=II(d,a,b,c,m[i+15],10,-30611744),c=II(c,d,a,b,m[i+6],15,-1560198380),b=II(b,c,d,a,m[i+13],21,1309151649),a=II(a,b,c,d,m[i+4],6,-145523070),d=II(d,a,b,c,m[i+11],10,-1120210379),c=II(c,d,a,b,m[i+2],15,718787259),b=II(b,c,d,a,m[i+9],21,-343485551),a=a+aa>>>0,b=b+bb>>>0,c=c+cc>>>0,d=d+dd>>>0}return crypt$$1.endian([a,b,c,d])};md5._ff=function(a,b,c,d,x,s,t){var n=a+(b&c|~b&d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._gg=function(a,b,c,d,x,s,t){var n=a+(b&d|c&~d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._hh=function(a,b,c,d,x,s,t){var n=a+(b^c^d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._ii=function(a,b,c,d,x,s,t){var n=a+(c^(b|~d))+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._blocksize=16,md5._digestsize=16,module.exports=function(message,options){if(void 0===message||null===message)throw new Error("Illegal argument "+message);var digestbytes=crypt$$1.wordsToBytes(md5(message,options));return options&&options.asBytes?digestbytes:options&&options.asString?bin.bytesToString(digestbytes):crypt$$1.bytesToHex(digestbytes)}}()}),at,ch,escapee={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},text,error$1=function error(m){throw{name:"SyntaxError",message:m,at:at,text:text}},next=function next(c){return c&&c!==ch&&error$1("Expected '"+c+"' instead of '"+ch+"'"),ch=text.charAt(at),at+=1,ch},number=function number(){var number,string="";for("-"===ch&&(string="-",next("-"));ch>="0"&&ch<="9";)string+=ch,next();if("."===ch)for(string+=".";next()&&ch>="0"&&ch<="9";)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),"-"!==ch&&"+"!==ch||(string+=ch,next());ch>="0"&&ch<="9";)string+=ch,next();if(number=+string,isFinite(number))return number;error$1("Bad number")},string=function string(){var hex,i,string="",uffff;if('"'===ch)for(;next();){if('"'===ch)return next(),string;if("\\"===ch)if(next(),"u"===ch){for(uffff=0,i=0;i<4&&(hex=parseInt(next(),16),isFinite(hex));i+=1)uffff=16*uffff+hex;string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error$1("Bad string")},white=function white(){for(;ch&&ch<=" ";)next()},word=function word(){switch(ch){case"t":return next("t"),next("r"),next("u"),next("e"),!0;case"f":return next("f"),next("a"),next("l"),next("s"),next("e"),!1;case"n":return next("n"),next("u"),next("l"),next("l"),null}error$1("Unexpected '"+ch+"'")},value,array=function array(){var array=[];if("["===ch){if(next("["),white(),"]"===ch)return next("]"),array;for(;ch;){if(array.push(value()),white(),"]"===ch)return next("]"),array;next(","),white()}}error$1("Bad array")},object=function object(){var key,object={};if("{"===ch){if(next("{"),white(),"}"===ch)return next("}"),object;for(;ch;){if(key=string(),white(),next(":"),Object.hasOwnProperty.call(object,key)&&error$1('Duplicate key "'+key+'"'),object[key]=value(),white(),"}"===ch)return next("}"),object;next(","),white()}}error$1("Bad object")};value=function value(){switch(white(),ch){case"{":return object();case"[":return array();case'"':return string();case"-":return number();default:return ch>="0"&&ch<="9"?number():word()}};var parse$1=function parse(source,reviver){var result;return text=source,at=0,ch=" ",result=value(),white(),ch&&error$1("Syntax error"),"function"==typeof reviver?function walk(holder,key){var k,v,value=holder[key];if(value&&"object"===(void 0===value?"undefined":_typeof(value)))for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}({"":result},""):result},escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep,stringify$2=function stringify(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!==(void 0===replacer?"undefined":_typeof(replacer))||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})},parse=parse$1,stringify$1=stringify$2,index$3={parse:parse,stringify:stringify$1},json="undefined"!=typeof JSON?JSON:index$3,index$2=function index(obj,opts){opts||(opts={}),"function"==typeof opts&&(opts={cmp:opts});var space=opts.space||"";"number"==typeof space&&(space=Array(space+1).join(" "));var cycles="boolean"==typeof opts.cycles&&opts.cycles,replacer=opts.replacer||function(key,value){return value},cmp=opts.cmp&&function(f){return function(node){return function(a,b){var aobj={key:a,value:node[a]},bobj={key:b,value:node[b]};return f(aobj,bobj)}}}(opts.cmp),seen=[];return function stringify(parent,key,node,level){var indent=space?"\n"+new Array(level+1).join(space):"",colonSeparator=space?": ":":";if(node&&node.toJSON&&"function"==typeof node.toJSON&&(node=node.toJSON()),void 0!==(node=replacer.call(parent,key,node))){if("object"!==(void 0===node?"undefined":_typeof(node))||null===node)return json.stringify(node);if(isArray(node)){for(var out=[],i=0;i<node.length;i++){var item=stringify(node,i,node[i],level+1)||json.stringify(null);out.push(indent+space+item)}return"["+out.join(",")+indent+"]"}if(-1!==seen.indexOf(node)){if(cycles)return json.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}seen.push(node);for(var keys=objectKeys(node).sort(cmp&&cmp(node)),out=[],i=0;i<keys.length;i++){var key=keys[i],value=stringify(node,key,node[key],level+1);if(value){var keyValue=json.stringify(key)+colonSeparator+value;out.push(indent+space+keyValue)}}return seen.splice(seen.indexOf(node),1),"{"+out.join(",")+indent+"}"}}({"":obj},"",obj,0)},isArray=Array.isArray||function(x){return"[object Array]"==={}.toString.call(x)},objectKeys=Object.keys||function(obj){var has=Object.prototype.hasOwnProperty||function(){return!0},keys=[];for(var key in obj)has.call(obj,key)&&keys.push(key);return keys};Object.setPrototypeOf(ImplementationError,Error),ImplementationError.prototype=Object.create(Error.prototype),ImplementationError.prototype.name="ImplementationError",ImplementationError.prototype.message="",ImplementationError.prototype.constructor=ImplementationError;var internal$4=Namespace("Multiton"),Multiton=function(){function Multiton(key){if(classCallCheck(this,Multiton),this.constructor.has(key))throw new Error('Attempt to create multiple instances for key "'+key+'"')}return createClass(Multiton,null,[{key:"has",value:function has(key){var scope=internal$4(this);if(void 0===scope.instances)return!1;var coercedKey=this.coerceMultitonKey(key);return void 0!==scope.instances[coercedKey]}},{key:"for",value:function _for(key){var scope=internal$4(this);scope.instances||(scope.instances=new Map);var coercedKey=this.coerceMultitonKey(key);if(scope.instances.has(coercedKey))return scope.instances.get(coercedKey);for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var instance=this.new.apply(this,[coercedKey].concat(args));return scope.instances.set(coercedKey,instance),instance}},{key:"new",value:function _new(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return new(Function.prototype.bind.apply(this,[null].concat(args)))}},{key:"coerceMultitonKey",value:function coerceMultitonKey(key){return key}}]),Multiton}(),internal$5=Namespace("Semaphore"),Task=function Task(semaphore,callback){var _this=this;classCallCheck(this,Task);var promises=[new Promise(function(resolve,reject){_this.resolve=resolve,_this.reject=reject}),new Promise(function(resolve){_this.let=resolve}).then(function(){callback(_this.resolve,_this.reject)})];this.promise=Promise.all(promises).then(function(values){return semaphore.signal(),values[0]},function(reason){return semaphore.signal(),Promise.reject(reason)})},Semaphore=function(){function Semaphore(capacity){classCallCheck(this,Semaphore);var scope=internal$5(this);scope.capacity=capacity,scope.available=capacity,scope.queue=[]}return createClass(Semaphore,[{key:"wait",value:function wait(callback){var scope=internal$5(this),task=new Task(this,callback);return 0===scope.available?scope.queue.push(task):(--scope.available,task.let()),task.promise}},{key:"signal",value:function signal(){var scope=internal$5(this);0===scope.queue.length?++scope.available:scope.queue.shift().let()}},{key:"capacity",get:function get$$1(){return internal$5(this).capacity}},{key:"available",get:function get$$1(){return internal$5(this).available}}]),Semaphore}(),internal$6=Namespace("Singleton"),Singleton=function(){function Singleton(){if(classCallCheck(this,Singleton),void 0!==internal$6(this.constructor).instance)throw new Error("Attempt to create multiple instances for singleton")}return createClass(Singleton,null,[{key:"get",value:function get$$1(){var scope=internal$6(this);return void 0===scope.instance&&(scope.instance=this.new.apply(this,arguments)),scope.instance}},{key:"new",value:function _new(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return new(Function.prototype.bind.apply(this,[null].concat(args)))}}]),Singleton}(),Stride=function(){function Stride(){classCallCheck(this,Stride)}return createClass(Stride,null,[{key:"transform",value:function transform(array,stride,callback){var values=[];return array.forEach(function(value,index){var modulo=index%stride;if(values[modulo]=value,modulo===stride-1)for(var transformed=callback.apply(void 0,values.concat([Math.floor(index/stride)])),offset=0;offset<stride;++offset)array[index-(stride-offset-1)]=transformed[offset]}),array}},{key:"forEach",value:function forEach(array,stride,callback){var values=[];array.forEach(function(value,index){var modulo=index%stride;values[modulo]=value,modulo===stride-1&&callback.apply(void 0,values.concat([Math.floor(index/stride)]))})}},{key:"some",value:function some(array,stride,callback){var values=[];return array.some(function(value,index){var modulo=index%stride;return values[modulo]=value,modulo===stride-1&&callback.apply(void 0,values.concat([Math.floor(index/stride)]))})}},{key:"every",value:function every(array,stride,callback){var values=[];return array.every(function(value,index){var modulo=index%stride;return values[modulo]=value,modulo!==stride-1||callback.apply(void 0,values.concat([Math.floor(index/stride)]))})}},{key:"reduce",value:function reduce(array,stride,callback,initial){var values=[];return array.reduce(function(result,value,index){var modulo=index%stride;return values[modulo]=value,modulo===stride-1?callback.apply(void 0,[result].concat(values,[Math.floor(index/stride)])):result},initial)}}]),Stride}(),base64Arraybuffer=createCommonjsModule(function(module,exports){!function(){for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var bufferLength=.75*base64.length,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}()});if("node"===Environment.type){var encoding=require("text-encoding");void 0===Environment.global.TextEncoder&&(Environment.global.TextEncoder=encoding.TextEncoder),void 0===Environment.global.TextDecoder&&(Environment.global.TextDecoder=encoding.TextDecoder)}var Transferral=function(){function Transferral(){classCallCheck(this,Transferral)}return createClass(Transferral,null,[{key:"encode",value:function encode$$1(object){if("function"!=typeof TextEncoder)throw new Error("TextEncoder is missing");var encoder=new TextEncoder,text=JSON.stringify(object);return encoder.encode(text).buffer}},{key:"decode",value:function decode$$1(buffer){if("function"!=typeof TextDecoder)throw new Error("TextDecoder is missing");var decoder=new TextDecoder,view=new DataView(buffer),text=decoder.decode(view);return JSON.parse(text)}},{key:"pack",value:function pack(buffer){return base64Arraybuffer.encode(buffer)}},{key:"unpack",value:function unpack(string){return base64Arraybuffer.decode(string)}},{key:"packBufferGeometry",value:function packBufferGeometry(geometry){var _this=this;Object.values(geometry.data.attributes).forEach(function(attribute){var constructor=Environment.global[attribute.type],buffer=new constructor(attribute.array).buffer;attribute.array=_this.pack(buffer)})}},{key:"unpackBufferGeometry",value:function unpackBufferGeometry(geometry){var _this2=this;Object.values(geometry.data.attributes).forEach(function(attribute){var constructor=Environment.global[attribute.type],buffer=_this2.unpack(attribute.array);attribute.array=Array.from(new constructor(buffer))})}}]),Transferral}();exports.Aggregate=Aggregate,exports.AggregateFunction=AggregateFunction,exports.AssertionError=AssertionError,exports.Environment=Environment,exports.FilePath=FilePath,exports.Hash=Hash,exports.ImplementationError=ImplementationError,exports.Multiton=Multiton,exports.Namespace=Namespace,exports.Semaphore=Semaphore,exports.Singleton=Singleton,exports.Stride=Stride,exports.Transferral=Transferral,Object.defineProperty(exports,"__esModule",{value:!0})});